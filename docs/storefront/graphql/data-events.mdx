# Data Events API in the GraphQL Storefront API

This article explains how to enable headless storefronts to use native analytics. The BigCommerce analytics system runs on data events. These are event objects that capture when a particular action has occurred (product added to a cart, shopper visited a website, an order was placed). All of the BigCommerce analytics features are based on event data being sent to our data pipeline.

This API is particularly helpful for analytical metrics such as Visits and the Product Views.

## Introduction

One of the key concepts in BigCommerce analytics is the concept of a visit or session. When sending events to BigCommerce it is important to send us a `visitId` and `visitorId` in UUID format. You can use the [UUID Generator](https://www.uuidgenerator.net/version4) to generate the parameters.

## Enabling a headless storefront

<Steps> 
### VisitStartedEvent mutation.

Execute the `VisitStartedEvent` mutation. Use `visitId` and `visitorId` (UUID format) in the `initiator` input. 

<Tabs items={['Request', 'Response']}>
  <Tab>

  ```http filename="Example query: VisitStartedEvent" showLineNumbers copy
  POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/graphql
  X-Auth-Token: {{ACCESS_TOKEN}}
  Content-Type: application/json
  Accept: application/json

  mutation VisitStartedEvent {
    analytics {
        visitStartedEvent(input: {
            commonInput: {
                eventId:"284434d0-ece1-4613-9602-98d4220bca53",
                initiator: {
                    visitId: "Visit Id",
                    visitorId: "Visitor Id"
                },
                request: {
                    url: "www.bigcommerce.com",
                    userAgent: "PostmanRuntime"
                },
                consent: {
                    targeting: true,
                    analytics: true,
                    functional: true
                }
            }
        }) {
            executed
        }
    }
}
  ```
  </Tab>
  <Tab>

  ```json filename="Example query: Get data layer enabled flag" showLineNumbers copy
  {
    "data": {
      "analytics": {
        "visitStartedEvent": {
          "executed": true
          }
        }
      }
    }
  ```
  </Tab>
</Tabs>


### ProductViewedEvent

Execute the `ProductViewedEvent` mutation. Use the same `visitId` and `visitorId` as in the `VisitStartedEvent`. This step links the product view to the visit.

<Tabs items={['Request', 'Response']}>
  <Tab>

  ```http filename="Example query: ProductViewedEvent" showLineNumbers copy
  POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/graphql
  X-Auth-Token: {{ACCESS_TOKEN}}
  Content-Type: application/json
  Accept: application/json

  mutation ProductViewedEvent {
    analytics {
        productViewedEvent(input: {
            commonInput: {
                eventId:"284434d0-ece1-4613-9602-98d4220bca53",
                initiator: {
                    visitId: "Visit Id",
                    visitorId: "Visitor Id"
                },
                request: {
                    url: "www.bigcommerce.com",
                    userAgent: "PostmanRuntime"
                },
                consent: {
                    targeting: true,
                    analytics: true,
                    functional: true
                }
            },
            productInput: {
                productEntityId: 88,
                searchKeyword: "test"
            }
        }) {
            executed
        }
    }
}
  ```
  </Tab>
  <Tab>

  ```json filename="Example query: ProductViewedEvent" showLineNumbers copy
  {
    "data": {
      "analytics": {
        "productViewedEvent": {
          "executed": true
          }
        }
      }
    }
  ```
  </Tab>
</Tabs>

### Redirect mutation

After adding a product to a cart and obtaining a `cart_id`, execute the `redirect` mutation. Use the same `visitId` and `visitorId` as in the `VisitStartedEvent` and specify the `cart_id`. You will generate a `redirectedCheckoutUrl`. 

<Tabs items={['Request', 'Response']}>
  <Tab>

  ```http filename="Example query: Redirect" showLineNumbers copy
  POST https://api.bigcommerce.com/stores/{{STORE_HASH}}/graphql
  X-Auth-Token: {{ACCESS_TOKEN}}
  Content-Type: application/json
  Accept: application/json

  mutation redirect {
    cart {
        createCartRedirectUrls (input: {
            cartEntityId: "2c0b561a-1288-4d21-b5b1-4009b75e38e2",
            visitId: "Visit Id",
            visitorId: "Visitor Id"
        }) {
            redirectUrls {
              redirectedCheckoutUrl,
              embeddedCheckoutUrl
        }
          errors {
            ... on Error {
                  message
          }
        }
      }
    }
}
 ```
  </Tab>
  <Tab>

  ```json filename="Example query: Redirect" showLineNumbers copy
  {
    "data": {
      "cart": {
        "createCartRedirectUrls": {
          "redirectUrls": {
              "redirectedCheckoutUrl": 
          }
        }
      }
    }
  ```
  </Tab>
</Tabs>

### Create an order

Navigate to the `redirectedCheckoutUrl` returned by the mutation. Proceed through checkout and create an order.

</Steps>
